<!DOCTYPE html>
<html>

	<head>
		<title> Criterion Programming User Portal</title>
		<link href="Assets/collectionConsole.css" rel="stylesheet"/>
		<link href="Images/favicon.png" rel="icon"/>
		<meta name="description" content="Collect and Check Up On Your Projects">
		<meta name="viewport" content="width: device-width ,  initial-scale: 1.0">
		<meta characterset = "UTF-8">	
	</head>

	<body id="mother">
	
		<div id="header">
		
			<img id="menuBtn" src="Images/menuinactive.png"/>
			<img id="logo" src="Images/logo.png"/>
		
		</div>
		
		<div id="menu-shape">
			<ul id="menu-list">
				<li id="menuLogin" class="menuItem">Login</li>
				<li id="menuAddJob" class="menuItem">New Job</li>
				<li id="menuViewProjects" class="menuItem">View Projects</li>
				<li id="menuChangePassword" class="menuItem">Change Password</li>
				<li id="menuAddAdmin" class="menuItem">Add Admin account</li>
				<li id="menuLogout" class="menuItem">Log Out</li>
			</ul>
		</div>
		
		<div id="mainSection">
	
			<div id="WelcomeScreen">
			
				<img id="backgroundImage" src="Images/backgroundOne.jpg"/>
			
				<div id="WelcomeAnimation">
				
					<p id="welcomeText"><b><i>Welcome</i></b></p>
				
				</div>
				
				<div id="StartPage">
				
					<p id="headerText1"><b><i>Your Journey To Success Starts here</i></b></p>
					<p id="headerText2">Welcome to our official online project management terminal</p>
					<p id="headerText3">Here you will be able to view updates on the projects you currently have with us.<br>
						You will also be able to give us feedback on any updates we make to your website or program.<br>
						Make use of our invoicing terminal to make installment payments on your project to avoid unneccessary inconviniences.
					</p>
					<button class="btnClassOne" id="loginBtnMain">START</button>
				</div>
				
				<div id="shapeArea">
				
					<div id="shape">
					
						<div id="userLoginSection">
						
							<p id="loginHeader">Type in your credentials to login</p>
							
							<div id="loginAdminHolder">
								<input class="addOptions" id="adminBtn" type = "checkbox" /><p class = "addOptionsText">Login as admin</p>

							</div>
							
							<input id="userIdInput" placeholder="User ID Number" class="inputClassTwo"/>
							<input id="userPasswordInput" placeholder="User Password" class="inputClassTwo" type="password"/>
							
							<button id="loginInit" class="btnClassTwo">Login</button>
							
							<p id="forgotPasswordBtn">Forgot Password? Click here</p>
						
						</div>
						
						<div id="addAdminSection">
						
							<p id="loginHeader">Add A New Admin</p>
							
							<p class="inputHeader">Name Details</p>
							<input id="adminFirstNaemInput" placeholder="First Name" class="inputClassTwo"/>
							<input id="adminLastNaemInput" placeholder="Last Name" class="inputClassTwo" />
							<p class="inputHeader">Credentials</p>
							<input id="adminInput" placeholder="Admin Email" class="inputClassTwo"/>
							<input id="adminPasswordInput" placeholder="Type in Password" class="inputClassTwo" type="password"/>
							<input id="adminConfirmPasswordInput" placeholder="Retype Password" class="inputClassTwo" type="password"/>
							<input id="adminScrtQstnInput" placeholder="Secret Question" class="inputClassTwo" />
							<input id="adminScrtQstnAnsInput" placeholder="Secret Question Answer" class="inputClassTwo" "/>
							
							<button id="adminInit" class="btnClassTwo">Add Admin</button>
						
						</div>
						
						<div id="forgotPasswordSection">
		
							<p id="forgotPassword_header">Type in your email address in the field below and click the button below to proceed</p>
							
							<input class="inputClassTwo" id="forgotPasswordAnswerInput" placeholder="Type in your email address here"/>
							<input class="inputClassTwo" id="forgotPasswordAnswerInput2" placeholder="Retype your password here"/>
							
							<button class="btnClassTwo" id="verifyEmail_forgotPassword">Verify</button>
						
						</div>
						
						<div id="addNewCustomerSection">
						
							<p id="loginHeader">Fill in the form fields below</p>
							
							<div id="newUserInfoSection">
								<input id="userFirstNameInput" placeholder="First Name" class="inputClassThree"/>
								<input id="userLastNameInput" placeholder="Last Name" class="inputClassThree"/>
								
								<p class="inputHeader">Email Address</p>
								<input id="emailInput" placeholder="Email Address" class="inputClassThree" 
								/>
								
								
								<p class="inputHeader">Add A Password</p>
								<input id="passwordInput" placeholder="Password" class="inputClassThree" type="password"/>
								<input id="passwordConfirmInput" placeholder="Confirm Password" class="inputClassThree"  type="password"/>
								
								<p class="inputHeader">Secret Question and Answer</p>
								<input id="sqInput" placeholder="Secret Question" class="inputClassThree" />
								<input id="sqaInput" placeholder="Secret Question Answer" class="inputClassThree" />
								
							</div>
							<p class="inputHeader">Project Name</p>
							<input id="projectNameInput" placeholder="Name Of Project" class="inputClassThree"/>
								
							<p class="inputHeader">Project Description</p>
							<textarea id="projectDesc" class="textAreaInput"></textarea>
							
							<p class="inputHeader" style="display: none">Select Your Country</p>
							
							<div id="countrySelectHolder" style="display: none"><p id="countrySelected">United States Of America USD</p></div>
							
							<p class="inputHeader">Production Services</p>
							
							<select id="jobOptions">
								<option class="jobOptionType" id="optionDefault" type="radio"/>-- Select a service to get price --</option>
								<option class="jobOptionType" id="optionOne" type="radio"/>Blog / Music / Media Distribution Website with user data base</option>
								<option class="jobOptionType" id="optionTwo" type="radio">Blog/ Music / Media Distribution & Streaming Website with user data base</option>
								<option class="jobOptionType" id="optionThree" type="radio">Blog Website with user data base</option>
								<option class="jobOptionType" id="optionFour" type="radio">Online Store for selling physical goods and shipping</option>
								<option class="jobOptionType" id="optionFive" type="radio">Organisation Website with user data base and chat functionality</option>
								<option class="jobOptionType" id="optionSix" type="radio">Customised Android App with user data base for your business/organisation</option>
								<option class="jobOptionType" id="optionSeven" type="radio">Customised Android & Desktop App with user data base and chat functionality for your business/organisation</option>
							</select>
							
							<div id="addOptionsHolder1">
								<input class="addOptions" id="addConsole1" type = "checkbox" /><p class = "addOptionsText">Include customised online website management portal</p>
								<input class="addOptions" id="addConsole2" type = "checkbox"/><p class = "addOptionsText">Include customised android management app</p>
								<input class="addOptions" id="addConsole3" type = "checkbox"/><p class = "addOptionsText">Include customised desktop management app</p>
							</div>
							
							<div id="addOptionsHolder2">
								<p id="freeHostingAdd">* Free 1 year hosting + Free lifetime maintainance services for all apps and servers</p>
							</div>
							
							<div id="payInput">
							
								<p id="currencyDsp" class="inputHeader2"> USD </p>
								<p id="amountDsp" class="inputHeader2"> 0 </p>
							
							</div>
							

							
							<button id="addUserInit" class="btnClassTwo">Sign Up</button>
						
						</div>
						
						<div id="reviewSection">
						
							<p id="pInfoHeader">Project Information</p>
							
							<p class="inputHeader" id="reviewIns">If you need maintainance services, simply send us a feedback explaining your problem.</p>
							
							<p class="inputHeader" id="rsPClientHeader">Client Name</p>
							<p class="infoHeader" id="rsPClient">Client Name</p>
							
							<p class="inputHeader" >Project Name</p>
							<p class="infoHeader" id="rsPname">Project Name</p>
							
						    <p class="inputHeader">Project Status</p>
							<p class="infoHeader" id="rsPStatus">In Progress</p>
							
							
							<p class="inputHeader">Value</p>
							<p class="infoHeader" id="rsPValue">0.00 USD</p>
							
							<p class="inputHeader">Project Description</p>
							<p class="descriptionHeader" id="rsPDesc">Description</p>
							
							<p class="inputHeader3" id="rsPBdown">BreakDown</p>
							<ul id="breakdown-list" id="rsPBdownlist">
								<li class="bItem">Server Design</li>
								<li class="bItem">Client Side Design</li>
							</ul>
							
							<button class="btnClassThree" id="payForJobNow">Make Payment</button>
							
							<div id="adminActiveHolder">
							
								<div id="adminActiveIcon"></div>
								<p id="adminActiveText">Admin is online</p>
							
							</div>
							
							<button id="quickFeedBack" class="btnClassThree">Send Feedback</button>
							
							<div id="cancelBtnHlder">
								<img src="Images/close.png" id="cancelIcon"/>
								<p id="cancelText">Cancel Job</p>
							</div>
							
							<p class="inputHeader3">Progress Updates</p>
							
							<p class="infoInsHeader"> Tap to send feedback </p>							        
							
							<div id="updatesContainer">
								<div class="updateCloud">
							        <p class="infoHeaderOne"> Subject </p>
							        <p class="infoDetailOne"> Subject </p>
							        <p class="infoHeaderOne"> Details </p>
							        <p class="infoDetailOne"> Details </p>
							        <p class="infoDateHeader"> DD/MM/YYYY HH:MM </p>
							        <button class="fileDownloadBtn"> Download Files </button>
								</div>
							</div>
						
						
						</div>
						
					    <div id="projectsOverview">
                            <p id="pInfoHeader"> Projects Overview </p>
							
							<p class="inputHeader"id="activeProjectsH">Active Projects</p>
							<p class="infoHeader" id="activeProjects">0 projects</p>
							
						    <p class="inputHeader" id="cancelledProjectsH">Cancelled Projects</p>
							<p class="infoHeader" id="cancelledProjects">0 projects</p>
							
							
							<p class="inputHeader" id="totalProjectRevenueH">Total Revenue</p>
							<p class="infoHeader" id="totalProjectRevenue">0.00 USD</p>
							
						    <p class="inputHeader" id="totalProjectRevenueLostH">Total Revenue Lost</p>
							<p class="infoHeader" id="totalProjectRevenueLost">0.00 USD</p>
							
						    <p class="inputHeader" id="updatesHeader">Unseen Updates (0)</p>							
							
							
							<p class="inputHeader">Projects</p>
							
		                    <p class="infoInsHeader"> Tap to view details </p>
                            
                            <div id="projectsContainer">
								<div class="updateCloud2">
								    
								    <img class="infoDeleteBtn" src="Images/close.png"/>
							        <p class="infoHeaderOne"> Name </p>
							        <p class="infoDetailOne"> Project Name </p>
							        <p class="infoHeaderOne"> Client Name </p>
							        <p class="infoDetailOne"> Client Name </p>
							        <p class="infoHeaderOne"> Project ID </p>
							        <p class="infoDetailOne"> Project ID </p>
							        <p class="infoDateHeader"> Created: DD/MM/YYYY HH:MM </p>
							        <p class="infoDateHeader">Due: DD/MM/YYYY</p>
							        
						
								</div>
							</div>
                            	
                        </div>
                        
                        <div id="provideFeedBack">
                            
                            <p id="pInfoHeader">Give Feedback</p>
							
							<p class="inputHeader">Subject</p>
							<p class="infoHeader" id="fdbackUpdateId">Update ID</p>
							
						    <p class="inputHeader">Message</p>
							<textarea id="messageInputfdback" class="textAreaInput"></textarea>
						    <p class="inputHeader">Add some screen shots to help us better understand your problem</p>
						    <p class="inputHeader2" id="screenshotsDsp">Screenshots(0)</p>
						    <p class="inputHeader2" id="screenshotsDelete">Delete last added</p>
						    <p class="infoInsHeader" id="screenshotsIns">click on button again once you have selected to add screenshot</p>
							
							<input id="addImage" accept=".jpg,.JPEG,.png" type="file" hidden></input>
							<button id="selectSecreenImage">Select Screenshot</button>
							
                            <button class="btnClassOne" id="sendFeedBack">Send Feed Back</button>
                            
                        </div>
                        
                        <div id="provideUpdate">
                            
                            <p id="pInfoHeader">Update Client</p>
							
							<p class="inputHeader">Subject</p>
							<p class="infoHeader" id="prjectUpdateID">Project ID</p>
							
						    <p class="inputHeader">Message</p>
							<textarea id="messageInputUpdate" class="textAreaInput"></textarea>
							
							<p id="fileNameDsp">file name</p>
							<input id="fileInput" type="file" accept=".zip" hidden></input>
							<p class="infoInsHeader" id="screenshotsIns2">click on button again once you have selected to add zip file</p>
							<button class="btnClassThree" id="selectFiles">Select Zip</button>
                            
                            <button class="btnClassOne" id="sendUpdate">Send Update</button>
                            
                        </div>
                        
                        <div id="payment-section">
                            
                            <p id="pInfoHeader">Make Payment</p>
							
							<p class="inputHeader">Right now you pay:</p>
							<p class="infoHeader" id="installmentAmount">0.00 USD</p>
							
							<p class="inputHeader">Total Amount Paid</p>
							<p class="infoHeader" id="totalAmountPaid">0.00 USD</p>
							
						    <p class="inputHeader">Total Job Price</p>

							<p class="infoHeader" id="amountDue">0.00 USD</p>
							
							<div id="payInFullHolder">
								<input class="addOptions" id="payInFullSwitch" type = "checkbox" /><p class = "addOptionsText">Pay Full Price (7% discount given)</p>

							</div>
							
						    <p id="Rules" class="inputHeader">Please take note of the following:</p>
							
							<div id="paymentsRulesListHolder">
								<ul id="paymentsRulesList">
									<li class="prItem">Jobs only start once payment of initial installment is made.</li>
									<li class="prItem">Jobs cannot be cancelled once payment is made.</li>
									<li class="prItem">No refunds are given once payment is made. Please be sure of your purchase</li>
									<li class="prItem">You must pay upto 35% of job value as initial installment for job to begin</li>
									<li class="prItem">Missed monthly payments will result in your server being turned off until payment is made</li>
									<li class="prItem">All servers and code are only transferred once payment is made</li>
								</ul>
							</div>
							
							
							<div class="updateCloud2" id="payBubble">
								    
								    
							        <p class="infoHeaderOne"> Name </p>
							        <p class="infoDetailOne" id="psName"> Project Name </p>
							        <p class="infoHeaderOne"> Client Name </p>
							        <p class="infoDetailOne" id="psClientName"> Client Name </p>
							        <p class="infoHeaderOne"> Project ID </p>
							        <p class="infoDetailOne" id="psPID"> Project ID </p>
							        <p class="infoDateHeader" id="psDateCreated"> Created: DD/MM/YYYY HH:MM </p>
							        <p class="infoDateHeader" id="psDateDue">Due: DD/MM/YYYY</p>
									

						
						    </div>
						    
						    <button class="btnClassThree" id="openPaypalBtn">Pay Now</button>
                            
                        </div>
					
					</div>
				
				</div>
			
			</div>
		
		</div>
		
<div id="dialogBackground">

<img id="closeBtn" src="Images/closewhite.png"/>

<div id="paypalProceedWindow">

	<p id="header_instruction">In the interest of your security and ours, all payments for Criterion Programming services are processed through paypal through our brand name "Shop Mate". Click proceed if you wish to continue.</p>
	
	<img id="paypalLogo" src="Images/paypal.png"/>
	
	<div id="initPaymentProcess" style="max-width:1000px;" ></div>

</div>

<div id="loadingWindow">

	<img id="loadingIcon" src="Images/loading.gif"/>

	<p id="loadingText">Processing...please wait</p>

</div>


<div id="promptDialog">

	<p id="promptText">Promp Message</p>
	
	<button class="btnClassTwo" id="yesBtn">YES</button>
	<button class="btnClassTwo" id="noBtn">NO</button>

</div>



<div id="alertDialogBox">

	<p id="alertMessage">Alert Message Text</p>
	
	<button class="btnClassTwo" id="closeAlertBtn">Close</button>

</div>

<div id="listDialogBox" >

	<p id="selectMessage">Select Message</p>

	<ul id="generalListing"></ul>

</div>

</div>

		
<script src="node_modules/socket.io/client-dist/socket.io.js"></script>

<script src="https://sandbox.paypal.com/sdk/js?client-id=AbBAhN4KA_82j0QSx3LOVPurpHGt40wsLtBUSBjfwIxxIbUDQW0_j5IrWfQ5scN8YihBWj40LbiZcCV4&components=buttons&currency=USD">
</script>
<script>

	var transferId;

	let cancelSequence = ()=>{
		setTimeout(()=>{
			setTimeout(alert("You have cancelled your order"),1000)
		},300)
	}	
	
	let errorSequence = ()=>{
		setTimeout(()=>{
			setTimeout(alert("Something went wrong trying to process your order. Please try again later."),1000)
		},300)
	}	
	
	let approveSequence = async(data)=>{
		
		let get = await fetch('api/orders/capture', {

			method: 'POST',

			body: JSON.stringify({

				orderID: transferId,
				intent: "CAPTURE"

			}),
			"headers":{"Content-Type":"application/json"}
			

		})
		
		let response = await get.json()
		
		if(response.status === "COMPLETED"){
		
			closePaypalProceed()
			
			newPayment.value = paymentValue
			
			let inputID = null 
			
			if(selectedJob.id != null){
				inputID = selectedJob.id
			}else{
				inputID = jobID			
			}
			
		
			let update = await fetch("/send-payment-data",{
				method: 'POST',
				body: JSON.stringify({

					userId: userData.id,
					payment: newPayment,
					jobId: inputID

				}),
				"headers":{"Content-Type":"application/json"}
			}) 
		
			let x = await update.json()
			
			console.log(x)
			
			if(x.status == true){
					
					selectedJob.payments = x.data.payments 
					selectedJob.type = x.data.type
					selectedJob.value = x.data.value
					selectedJob.currency = x.data.currency
					selectedJob.installmentPaid = x.data.installmentPaid
					selectedJob.status = x.data.status
					
					let jobs = userData.jobs
					
					let index = jobs.findIndex((jobs)=>{
						return jobs.id === selectedJob.id
					})
					
					userData.jobs[index] = selectedJob
					
					let message = "Your payment has been made successfully. Your new job ID is: "+jobID
					let message2 = "Your payment has been made successfully"
					
					swapPages(3)
					if(newPayment.firstInstallment == false){
						setTimeout(alert(message2),300)
					}else{
						setTimeout(alert(message),300)
					}
				
			}else{
				setTimeout(alert("Something went wrong. Please try again later"),300)
			}
			
		}else{
			setTimeout(alert("Something went wrong. Please try again later"),300)
		}
		
		
		
	}	
	
	
	
	paypal.Buttons({

		  "style": {

			"layout": "vertical",

			"color":  "blue",

			"shape" :  "rect",

			"label":  "paypal"

		  },
		  createOrder: async function(data,actions) {

          const response = await fetch("/create-paypal-order", {

            method: "POST",

            headers: {
                    'content-type': 'application/json'
                },

            body: JSON.stringify({
				"job":selectedJob,
				"value":paymentValue
			})

          })

          var data = await response.json()
		  
		  transferId = data.id
		  
          return data.id

        },
		onApprove: async function(data,actions) {

			await approveSequence(data)

		},
		onCancel(data) {

			cancelSequence()

		},
		onError(){

			errorSequence()

		}

	}).render('#initPaymentProcess')
</script>
		
		<script src="Assets/collectionConsole.js"></script>
	</body>

</html>